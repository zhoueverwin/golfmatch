# GolfMatch - ゴルフマッチ

## アプリ概要

GolfMatch（ゴルフマッチ）は、ゴルフを愛する人々のためのマッチングアプリです。ゴルフという共通の趣味を通じて、新しい出会いやパートナーを見つけることができます。日本全国のゴルファーが集まり、ゴルフラウンドのパートナー探しから、より深い関係性の構築まで、様々な出会いの可能性を提供します。

## アプリ構成

アプリは5つのメインタブで構成されています：

| タブ | 機能 |
|------|------|
| **ホーム** | ソーシャルフィード（投稿の閲覧・作成） |
| **さがす** | ユーザー検索・マッチング |
| **つながり** | いいね一覧・マッチング一覧 |
| **メッセージ** | チャット・ダイレクトメッセージ |
| **マイページ** | プロフィール・設定・各種管理 |

---

## 主な機能

### 1. ユーザープロフィール

#### 基本情報
- **名前**: ニックネーム
- **年齢**: 生年月日から自動計算
- **性別**: 男性・女性・その他
- **居住地**: 都道府県選択
- **血液型**: A・B・O・AB型
- **身長**: cm単位で設定
- **体型**: 自由記述
- **喫煙**: 喫煙習慣の有無

#### ゴルフ情報
- **スキルレベル**: ビギナー、中級者、上級者、プロの4段階
- **ゴルフ経験年数**: 年数を設定
- **平均スコア**: 数値で設定
- **ベストスコア**: 数値で設定
- **交通手段**: 車、電車など
- **お気に入りのクラブ**: 愛用クラブを記載
- **プレー可能日**: カレンダーで設定

#### その他
- **プロフィール写真**: 複数枚アップロード可能（自動圧縮機能付き）
- **自己紹介文**: 自由に記入
- **性格タイプ**: 自己申告の性格
- **プロフィール完成度**: パーセンテージで表示

#### バッジ表示
- **本人確認バッジ**: KYC認証完了後に表示
- **プレミアムバッジ**: 有料会員に金色バッジを表示

---

### 2. マッチング機能

#### いいね機能
- **いいね**: 気になるユーザーに送信
- **スーパーいいね**: 特別な関心を示すアクション
- **パス**: 興味がない場合にスキップ

#### マッチング成立
- お互いに「いいね」を送った場合、マッチング成立
- マッチング成立時にお祝いモーダルを表示
- マッチング後すぐにメッセージ送信が可能

#### インテリジェント・レコメンデーション
マッチングのおすすめは以下の要素を考慮して算出されます：
- **カレンダー一致度**: プレー可能日の重複度
- **ゴルフスキル類似度**: スキルレベルの近さ
- **スコア類似度**: 平均スコアの近さ
- **地理的近接性**: 同じ地域・都道府県
- **プロフィール充実度**: プロフィールの完成度
- **アクティビティスコア**: 最近の活動状況

---

### 3. メッセージ機能

#### リアルタイムチャット
- マッチングしたユーザーと1対1のチャット
- Supabase Realtimeによるリアルタイム配信
- 既読・未読ステータス表示

#### 送信可能なコンテンツ
- **テキストメッセージ**: 通常のテキスト
- **画像**: 写真を送信（自動圧縮）
- **動画**: 動画ファイルを送信（自動圧縮）
- **絵文字**: 絵文字メッセージ

#### チャット一覧機能
- 最終メッセージのプレビュー表示
- 未読メッセージ数の表示
- 「返信が必要」インジケーター
- 未メッセージのマッチ一覧表示

---

### 4. ソーシャルフィード（ホーム）

#### 投稿機能
- ゴルフに関するテキスト投稿
- 画像・動画の添付（アスペクト比自動保存）
- 投稿の編集・削除
- 投稿の非表示（他ユーザーの投稿を非表示に）

#### フィード表示
- **おすすめ順**: レコメンドアルゴリズムによるソート
- **フォロー順**: 時系列での表示

#### リアクション機能
- **いいね（サムズアップ）**: 投稿への反応
- リアクションタイプ: nice, good_job, helpful, inspiring
- 1投稿につき1ユーザー1リアクション
- リアルタイムでリアクション数を更新

#### ユーザー投稿
- 特定ユーザーの投稿一覧を表示
- プロフィール画面から投稿へアクセス

---

### 5. ユーザー検索・発見

#### 検索タブ
- カード形式（2カラムグリッド）でユーザー表示
- 無限スクロール対応
- プルダウンで更新

#### ソートオプション
- **おすすめ順**: インテリジェント・マッチングスコア順
- **登録順**: 新規登録ユーザー順

#### 詳細フィルター
| フィルター項目 | 選択肢 |
|--------------|--------|
| **年齢** | 20代、30代、40代、50代、60代、70代以上（複数選択可） |
| **居住地** | 47都道府県から選択 |
| **スキルレベル** | ビギナー、中級者、上級者、プロ |
| **平均スコア** | 80以下、90以下、100以下、110以下、120以下、130以下、指定しない |
| **最終ログイン** | 24時間以内、3日以内、7日以内、30日以内、指定しない |

#### フィルター機能
- フィルター設定は自動保存（AsyncStorage）
- アクティブなフィルター数を表示
- フィルターリセット機能

---

### 6. つながり管理

#### いいねタブ
- **もらったいいね**: 自分が受け取った「いいね」一覧
- **いいね返し済み表示**: 相手にいいねを返したかどうかのインジケーター
- 相手のプロフィールを確認してアクションを決定

#### マッチタブ
- マッチングしたユーザー一覧
- 各マッチからチャット画面へ直接遷移
- マッチング日時の表示

#### 過去のいいね
- 自分が送った「いいね」の履歴
- タイムスタンプ付きで確認可能

---

### 7. 足あと機能（プロフィール閲覧履歴）

- **足あと一覧**: 自分のプロフィールを閲覧したユーザーを確認
- **閲覧日時**: いつ閲覧されたか表示
- **新着インジケーター**: 未確認の足あとに緑のドット表示
- **一括既読**: すべての足あとを既読にする機能
- **リアルタイム更新**: 新しい足あとをリアルタイムで通知

---

### 8. カレンダー機能

#### プレー可能日の設定
- 月ごとにカレンダー表示
- 日付をタップして空き状況を設定
- タイムスロット（時間帯）の選択
- メモの追加

#### 活用方法
- 他のユーザーに自分の空き状況を公開
- マッチングのおすすめスコアに反映
- マイページで直近の予定を確認

---

### 9. 本人確認（KYC認証）

#### 7ステップ認証プロセス
1. **同意画面**: 認証の説明と同意取得
2. **身分証選択**: マイナンバーカード、運転免許証、パスポート、保険証から選択
3. **身分証（表面）撮影**: 身分証明書の表面を撮影
4. **身分証（裏面）撮影**: 身分証明書の裏面を撮影
5. **セルフィー撮影**: 自撮り写真を撮影
6. **身分証セルフィー**: 身分証を持った状態で自撮り
7. **ゴルフ写真**: ゴルフクラブを持った写真またはゴルフ場での写真
8. **確認・送信**: 全ての写真を確認して送信

#### 審査ステータス
| ステータス | 説明 |
|-----------|------|
| `not_started` | 未申請 |
| `pending_review` | 管理者審査中 |
| `approved` | 承認済み（バッジ付与） |
| `retry` | 再提出が必要（理由表示） |
| `rejected` | 却下 |

#### 再提出機能
- 審査で不承認になった場合、却下理由を確認して再提出可能
- 再提出回数をトラッキング

---

### 10. 通知機能

#### 通知タイプ
| タイプ | 内容 |
|--------|------|
| **マッチング** | 新しいマッチングが成立 |
| **いいね** | 新しい「いいね」を受信 |
| **メッセージ** | 新しいメッセージを受信 |
| **投稿リアクション** | 自分の投稿にリアクション |

#### プッシュ通知
- Expo Push Notificationsを使用
- アプリがバックグラウンドでもプッシュ通知を受信
- フォアグラウンドではトースト通知を表示

#### バッジ表示
- **つながりタブ**: 新しいいいね・マッチがある場合に緑ドット
- **メッセージタブ**: 未読メッセージがある場合に緑ドット
- **マイページタブ**: 新しいお知らせ・足あとがある場合に緑ドット

#### 通知設定
- 通知タイプごとにオン/オフ設定
- プッシュ通知の全体オン/オフ
- 設定はデータベースに保存

#### 通知履歴（お知らせ）
- 過去の通知一覧を表示
- 既読/未読ステータス
- 個別または一括で既読にする

---

### 11. 安全・セキュリティ機能

#### ブロック機能
- 特定のユーザーをブロック
- ブロックしたユーザー一覧を確認
- ブロック解除機能
- ブロックしたユーザーは検索結果やおすすめに表示されない

#### 通報機能
- ユーザー、投稿、メッセージを通報可能
- **通報カテゴリ**:
  - 不適切なコンテンツ
  - スパム
  - ハラスメント
  - 詐欺
  - 不適切なメディア
  - 虚偽の情報
  - その他
- 10〜1000文字の説明を記入
- レート制限: 1時間に5件まで
- 自分自身や重複通報は不可

#### 投稿の非表示
- 他のユーザーの投稿を非表示に設定
- 非表示にした投稿の一覧を確認
- 非表示を解除して再表示

---

### 12. 設定・アカウント管理

#### プロフィール編集
- すべてのプロフィール項目を編集可能
- プロフィール写真の追加・削除・並び替え

#### アカウント連携
既存アカウントに追加の認証方法を連携可能：
- 電話番号連携
- メールアドレス連携
- Googleアカウント連携
- Apple ID連携

#### 設定メニュー
- 本人確認（KYC）
- 通知設定
- ブロックしたユーザー
- 非表示にした投稿
- アプリについて・ウェブサイト
- アカウント削除

#### アカウント削除
- 完全なアカウント削除機能
- 削除前に確認画面を表示
- 削除は取り消し不可

---

### 13. ヘルプ・サポート

#### ヘルプセクション
- よくある質問（FAQ）一覧
- 各トピックの詳細説明ページ

#### お問い合わせ機能
- アプリ内からサポートに問い合わせ可能
- 問い合わせカテゴリ選択
- サポートチームからの返信を確認
- 返信の既読/未読管理

---

## 認証方法

GolfMatchでは、以下の認証方法に対応しています：

| 方法 | 説明 |
|------|------|
| **電話番号認証（OTP）** | SMSで送信される6桁の認証コードを使用 |
| **メールアドレス・パスワード** | メールアドレスとパスワードでのログイン |
| **Googleアカウント** | Googleアカウントでワンタップログイン |
| **Apple ID** | Appleアカウントで簡単ログイン（iOS） |

### アカウント連携
一度ログインした後、設定画面から他の認証方法を追加で連携できます。これにより、複数の方法でログインが可能になります。

---

## メンバーシッププラン

GolfMatchでは、一部機能を使用するためにプレミアムメンバーシップへの加入が必要です。

### プレミアムプラン
- **価格**: 月額制（RevenueCatで管理）
- **支払い方法**: App Store（iOS）/ Google Play（Android）
- **自動更新**: 月次で自動更新（設定でキャンセル可能）

### プレミアム機能
- メッセージの送受信が無制限
- マッチングしたユーザーとチャット可能
- プロフィールにゴールドバッジを表示

### プレミアムステータスの種類
| ソース | 説明 |
|--------|------|
| `revenuecat` | RevenueCat経由の通常購入 |
| `manual` | 管理者による手動付与 |
| `permanent` | 永久プレミアム（ダウングレード不可） |

### 購入の復元
アプリを再インストールした場合や、新しいデバイスに移行した場合でも、「購入を復元」機能を使用して、以前の購入を復元できます。

---

## 技術仕様

### プラットフォーム
- **iOS**: iPhone対応（Expo SDK 54）
- **Android**: Androidスマートフォン対応

### 使用技術
| カテゴリ | 技術 |
|----------|------|
| **フレームワーク** | React Native (Expo SDK 54) + TypeScript |
| **ナビゲーション** | React Navigation 7（Stack + Bottom Tabs） |
| **状態管理** | React Context + TanStack Query v5 |
| **バックエンド** | Supabase（PostgreSQL、Auth、Realtime、Storage、Edge Functions） |
| **課金** | RevenueCat |
| **プッシュ通知** | Expo Push Notifications |
| **リスト最適化** | FlashList |
| **分析** | Facebook SDK（Meta Ads） |
| **エラー追跡** | Sentry |

### リアルタイム機能
Supabase Realtimeを使用して以下をリアルタイム同期：
- 新しいメッセージ
- 新しいいいね
- 新しいマッチング
- 投稿へのリアクション
- プロフィール閲覧（足あと）
- ユーザーのオンライン状態

### データベーステーブル
| テーブル | 用途 |
|----------|------|
| `profiles` | ユーザープロフィール（auth.usersとuser_idで連携） |
| `user_likes` | いいね・スーパーいいね・パス |
| `matches` | マッチング情報 |
| `chats` | チャットルーム |
| `messages` | チャットメッセージ |
| `posts` | ソーシャル投稿 |
| `post_reactions` | 投稿へのリアクション |
| `notifications` | 通知履歴 |
| `notification_preferences` | 通知設定 |
| `profile_views` | 足あと（プロフィール閲覧履歴） |
| `availability` | カレンダー空き状況 |
| `kyc_submissions` | KYC申請データ |
| `memberships` | メンバーシップ購入履歴 |
| `user_blocks` | ブロック関係 |
| `reports` | 通報データ |
| `contact_inquiries` | お問い合わせ |
| `contact_replies` | サポート返信 |

### パフォーマンス最適化
- FlashListによる高速リスト描画
- 画像・動画の自動圧縮
- TTLベースのキャッシュ機能
- リクエストの重複排除
- 指数バックオフ付きリトライロジック（3回、1〜10秒）

---

## プライバシーとセキュリティ

- **Row Level Security (RLS)**: Supabaseの行レベルセキュリティで データアクセスを制御
- **データ暗号化**: すべての通信はHTTPSで暗号化
- **本人確認**: KYC認証により、なりすましを防止
- **ブロック機能**: 不快なユーザーをブロック可能
- **通報機能**: 不適切なコンテンツや行為を通報可能
- **アカウント削除**: いつでもアカウントを完全に削除可能

---

## サポート

アプリ内の「ヘルプ」セクションから、よくある質問を確認したり、お問い合わせを送信することができます。お問い合わせには、サポートチームから返信があり、アプリ内で確認できます。

---

## 利用規約

アプリを利用する前に、利用規約とプライバシーポリシーを必ずお読みください。アプリ内の「設定」→「プライバシーポリシーと利用規約」から確認できます。

---

**GolfMatchで、ゴルフを通じた素敵な出会いを見つけてください！**
